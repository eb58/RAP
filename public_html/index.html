<!DOCTYPE html>
<html>
  <head>
    <title>Referenzarbeitsplatz</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed" >    
    <link rel="stylesheet" href="vendor/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="vendor/jQueryUI-1.11.0/jquery-ui.css">
    
    <link rel="stylesheet" href="vendor/simplePagination/simplePagination.css"/>
    <link rel="stylesheet" href="vendor/jQuery-contextmenu/jquery.contextMenu.min.css"/>
    <link rel="stylesheet" href="vendor/eblib/ebtree.css"/>
    <link rel="stylesheet" href="css/styles.css"/>

    <style>
    * {
      font-family: roboto, arial;
      font-size: 12px;
    }
    </style>

    <script src="vendor/pdfjs/compatibility.js"></script>
    <script src="vendor/pdfjs/pdf.js"></script>
    <script src="vendor/pdfjs/pdf.worker.js"></script>

    <script src="vendor/jQuery-1.11.3/jquery.min.js"></script>
    <script src="vendor/jQueryUI-1.11.0/jquery-ui.min.js"></script>

    <script src="vendor/underscore-1.8.3/underscore.min.js"></script>
    <script src="vendor/jQuery-contextmenu/jquery.contextMenu.js"></script>
    <script src="vendor/simplePagination/simplePagination.js"></script>
    <script src="vendor/fabric.js/fabric.js"></script>

    <script src="vendor/eblib/ebutils.js"></script>
    <script src="vendor/eblib/ebbind.js"></script>
    <script src="vendor/eblib/ebdropdown.js"></script>
    <script src="vendor/eblib/ebtree.js"></script>
    <script src="vendor/eblib/tinypubsub.js"></script>

    <script src="js/utils/constants.js"></script>
    <script src="js/utils/utils.js"></script>
    <script src="js/utils/geom.js"></script>
    <script src="js/utils/pdfmgr.js"></script>
    <script src="js/utils/filterObject.js"></script>

    <script src="js/model/ModelRap.js"></script>
<!--    <script src="js/model/mdlshrinker.js"></script>-->
<!--    <script src="js/model/mdlconvert12.js"></script>-->

    <script src="js/view/viewpdf.js"></script>
    <script src="js/view/viewesv.js"></script>
    <script src="js/view/viewwrk.js"></script>
    <script src="js/view/viewflds.js"></script>
    <script src="js/view/viewmain.js"></script>

    <script src="js/data/esvtypesForPages.js"></script>
    <script src="js/data/generatedMasks.js"></script>
<!--    <script src="js/data/testMasks.js"></script>-->
    <script src="js/data/codesTable.js"></script>
    <script>
      function initModelForTest(m) {
        m.setPageType(m.getPage(0), 'A3_Vorderseite');
        m.setPageType(m.getPage(1), 'BV_Vorderseite');
        m.setPageType(m.getPage(3), 'A1_Vorderseite');
        m.setPageType(m.getPage(5), 'A2_Vorderseite');
        m.setPageType(m.getPage(7), 'A3_Vorderseite');
        return m;

        // esv1
        var rec = m.addRecord(m.createRecord('A3E_Recht'));
        { // add fragments
          var area1 = m.createArea(0, {x: 0, y: 200}, {x: 800, y: 350});
          var frag1 = m.addFragment(m.createFragment(area1));
          m.addFragment2Record(rec, frag1);
          //var area2 = m.addArea(frag, m.createArea(0, {x: 300, y: 355}, {x: 740, y: 495}));
//          m.addParameter(frag1, area1, m.createParameter(0, {x: 200, y: 100}, {x: 400, y: 130}));
//
//          var frag2 = m.addFragment(m.createFragment(m.createArea(0, {x: 0, y: 75}, {x: 740, y: 125}),'A3E_Recht'));
//          m.addFragment2Record(rec, frag2);
//          frag1 = m.joinFragments([frag1.id, frag2.id]);
//          var area = m.addArea(frag1, m.createArea(0, {x: 0, y: 355}, {x: 740, y: 495}));
//          m.addParameter(frag1, area, m.createParameter(0, {x: 300, y: 13}, {x: 660, y: 42}));
//
//          var frag3 = m.addFragment(m.createFragment(m.createArea(0, {x: 0, y: 200}, {x: 740, y: 325}),'A3E_Recht'));
//          m.addFragment2Record(rec, frag3);
//          m.addArea(frag3, m.createArea(0, {x: 0, y: 355}, {x: 740, y: 495}));
//          m.addArea(frag3, m.createArea(0, {x: 0, y: 555}, {x: 740, y: 595}));
        }
        // esv2
//        var rec = m.addRecord(m.createRecord('A3E_Recht'));
//        { // add fragments
//          m.addFragment2Record(rec, m.addFragment(m.createFragment(m.createArea(1, {x: 0, y: 175}, {x: 740, y: 225}))));
//          m.addFragment2Record(rec, m.addFragment(m.createFragment(m.createArea(1, {x: 0, y: 375}, {x: 740, y: 425}))));
//        }

//        var rec1 = mdl.addRecord('TEST1');
//        var frag1 = rec1.addFragment(mdl.createFragment(mdl.createArea(0, {x: 0, y: 75}, {x: 740, y: 200})));
//        frag1.addArea(mdl.createArea(0, {x: 0, y: 385}, {x: 740, y: 425}));
//        frag1.addParameter(0, {x: 60, y: 5}, {x: 660, y: 50})
//
//        var frag2 = rec1.addFragment(mdl.createFragment(mdl.createArea(0, {x: 0, y: 200}, {x: 740, y: 325})));
//        frag2.addParameter(0, {x: 30, y: 15}, {x: 660, y: 50})
//
//        rec1.addFragment(mdl.createFragment(mdl.createArea(0, {x: 0, y: 350}, {x: 740, y: 425})));
//
//        var rec2 = mdl.addRecord('TEST2');
//        rec2.addFragment(mdl.createFragment(mdl.createArea(1, {x: 0, y: 375}, {x: 740, y: 425})));
//        rec2.addFragment(mdl.createFragment(mdl.createArea(1, {x: 0, y: 175}, {x: 740, y: 225})));
//
//        var rec3 = mdl.addRecord('A3E_Recht');
//        rec3.addFragment(mdl.createFragment(mdl.createArea(2, {x: 0, y: 175}, {x: 740, y: 225})));
//        rec3.addFragment(mdl.createFragment(mdl.createArea(2, {x: 0, y: 275}, {x: 740, y: 325})));
        return m;
      }
      var mdl, viewmain, keepMdlData;

      $(document).ready(function () {
        var pdf = '/data/pdfsEchtdaten/3201_2930_3455.pdf';
        var pdf = '/data/pdfsEchtdaten/3105_0603_366.pdf';
        var pdf = '/data/pdfsEchtdaten/3405_6003_2182.pdf';
        var pdf = '/data/pdfsEchtdaten/3201_3105_6378.pdf';
        var pdf = '/data/pdfsEchtdaten/2408_5078_1313.pdf';
        var pdf = '/data/pdfsEchtdaten/3405_6012_4748.pdf';
        var pdf = '/data/pdfsEchtdaten/3105_0608_877.pdf';
        var pdf = '/data/pdfsEchtdaten/1104_6294_2635.pdf';
        var pdf = 'data/pdfs/mondstadt.pdf';

        var delPdfFunction = function () {
          console.log('delPdfFunction called');
        };

        var init = function () {
          getPdfMgr(pdf, function (pdfmgr) {
            mdl = new ModelRap(pdfmgr, localStorage['rap.data']);
            viewmain = $('#mainrap').viewmain(mdl);
          }, delPdfFunction);
        };

        init();

        $('#save').on('click', function () {
          localStorage['rap.data'] = mdlshrinker.shrinkModel(mdl).getJSON(['isDirty']);
          init();
        });
        $('#load').on('click', function () {
          init();
        });
        $('#cancel').on('click', function () {
          if (mdl.isDirty && confirm('Es liegen ungespeicherte Ver\u00e4nderungen vor, diese gehen verloren, fortfahren?')) {
            console.log('AAAAAAAA');
          }
        });
      });

    </script>
  </head>
  <body>
    <div id="mainrap"></div>
    <button id="save">Save</button>
    <button id="load">Load</button>
    <button id="cancel">Cancel</button>
  </body>
</html>